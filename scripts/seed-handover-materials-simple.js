const { PrismaClient } = require('../prisma/generated/prisma-client');

const prisma = new PrismaClient({
  datasources: {
    db: {
      url: process.env.DATABASE_URL || 'mysql://root:@localhost:3306/gateway_app'
    }
  }
});

async function seedHandoverMaterials() {
  try {
    console.log('üå± Starting handover materials seed...');

    // Clear existing data
    await prisma.handoverMaterial.deleteMany({});
    await prisma.handoverReport.deleteMany({});
    await prisma.material.deleteMany({});

    console.log('üóëÔ∏è Cleared existing data');

    // Create materials for B√°o c√°o b·∫øp
    const kitchenMaterials = [
      { name: 'M√¨', reportType: 'BAO_CAO_BEP', isOnFood: true },
      { name: 'Khoai t√¢y', reportType: 'BAO_CAO_BEP', isOnFood: true },
      { name: 'Ch·∫£ c√°', reportType: 'BAO_CAO_BEP', isOnFood: true },
      { name: 'B√≤', reportType: 'BAO_CAO_BEP', isOnFood: true },
      { name: 'Ba r·ªçi', reportType: 'BAO_CAO_BEP', isOnFood: true },
      { name: 'G√†', reportType: 'BAO_CAO_BEP', isOnFood: true },
      { name: 'B√≤ vi√™n', reportType: 'BAO_CAO_BEP', isOnFood: true },
      { name: 'X√∫c x√≠ch', reportType: 'BAO_CAO_BEP', isOnFood: true },
      { name: 'C√° vi√™n', reportType: 'BAO_CAO_BEP', isOnFood: true },
      { name: 'Tr·ª©ng', reportType: 'BAO_CAO_BEP', isOnFood: true },
      { name: 'H·∫£i s·∫£n', reportType: 'BAO_CAO_BEP', isOnFood: true },
      { name: 'X√∫c x√≠ch nh·ªè', reportType: 'BAO_CAO_BEP', isOnFood: true },
      { name: 'M√¨ cay', reportType: 'BAO_CAO_BEP', isOnFood: true },
      { name: 'Ph·ªü tr·ªôn', reportType: 'BAO_CAO_BEP', isOnFood: true },
      { name: 'M·ª±c', reportType: 'BAO_CAO_BEP', isOnFood: true },
      { name: 'ƒê√πi g√†', reportType: 'BAO_CAO_BEP', isOnFood: true },
    ];

    // Create materials for B√°o c√°o n∆∞·ªõc
    const drinkMaterials = [
      { name: '7Up', reportType: 'BAO_CAO_NUOC', isOnFood: false },
      { name: 'Pepsi', reportType: 'BAO_CAO_NUOC', isOnFood: false },
      { name: 'Sting D√¢u', reportType: 'BAO_CAO_NUOC', isOnFood: false },
      { name: 'Sting Gold', reportType: 'BAO_CAO_NUOC', isOnFood: false },
      { name: 'Warrior D√¢u', reportType: 'BAO_CAO_NUOC', isOnFood: false },
      { name: 'Warrior Nho', reportType: 'BAO_CAO_NUOC', isOnFood: false },
      { name: 'Twister', reportType: 'BAO_CAO_NUOC', isOnFood: false },
      { name: 'Tr√† √î Long Tea+', reportType: 'BAO_CAO_NUOC', isOnFood: false },
      { name: 'Redbull', reportType: 'BAO_CAO_NUOC', isOnFood: false },
      { name: 'C2 Chanh', reportType: 'BAO_CAO_NUOC', isOnFood: false },
      { name: 'C2 ƒê√†o', reportType: 'BAO_CAO_NUOC', isOnFood: false },
      { name: 'Mirinda x√° x·ªã', reportType: 'BAO_CAO_NUOC', isOnFood: false },
      { name: 'Doctor Thanh', reportType: 'BAO_CAO_NUOC', isOnFood: false },
      { name: 'Su·ªëi', reportType: 'BAO_CAO_NUOC', isOnFood: false },
      { name: 'Monster NB', reportType: 'BAO_CAO_NUOC', isOnFood: false },
      { name: 'Monster Xo√†i', reportType: 'BAO_CAO_NUOC', isOnFood: false },
    ];

    const allMaterials = [...kitchenMaterials, ...drinkMaterials];

    // Insert materials and store their IDs
    const materialMap = new Map();
    for (const material of allMaterials) {
      const createdMaterial = await prisma.material.create({
        data: material
      });
      materialMap.set(material.name, createdMaterial.id);
    }

    console.log(`‚úÖ Created ${allMaterials.length} materials`);

    // Create handover reports for different dates
    const today = new Date();
    const yesterday = new Date(today);
    yesterday.setDate(yesterday.getDate() - 1);
    const twoDaysAgo = new Date(today);
    twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);

    const reportDates = [
      { date: today, label: 'Today' },
      { date: yesterday, label: 'Yesterday' },
      { date: twoDaysAgo, label: 'Two days ago' }
    ];

    for (const { date, label } of reportDates) {
      console.log(`üìÖ Creating reports for ${label} (${date.toISOString().split('T')[0]})`);

      // Create B√°o c√°o b·∫øp
      const kitchenReport = await prisma.handoverReport.create({
        data: {
          date: date,
          reportType: 'BAO_CAO_BEP',
          branch: 'GO_VAP',
          note: `B√°o c√°o b·∫øp ${label}`
        }
      });

      // Create B√°o c√°o n∆∞·ªõc
      const drinkReport = await prisma.handoverReport.create({
        data: {
          date: date,
          reportType: 'BAO_CAO_NUOC',
          branch: 'GO_VAP',
          note: `B√°o c√°o n∆∞·ªõc ${label}`
        }
      });

      // Create handover materials for kitchen report - map all kitchen materials
      const kitchenHandoverMaterials = [];
      
      for (const material of kitchenMaterials) {
        const materialId = materialMap.get(material.name);
        
        // Generate different data patterns for different materials
        let handoverData;
        
        if (material.name === 'M√¨') {
          // Case 1: Ca s√°ng kh√¥ng update, ca chi·ªÅu update th·ª±c t·∫ø
          handoverData = {
            handoverReportId: kitchenReport.id,
            materialId: materialId,
            morningBeginning: 0,
            morningReceived: 0,
            morningIssued: 0,
            morningEnding: 0,
            afternoonBeginning: 50,
            afternoonReceived: 20,
            afternoonIssued: 15,
            afternoonEnding: 55,
            eveningBeginning: 0,
            eveningReceived: 0,
            eveningIssued: 0,
            eveningEnding: 0,
          };
        } else if (material.name === 'B√≤') {
          // Case 2: Ca s√°ng b√°o c√°o sai - T·ªìn cu·ªëi 40, nh∆∞ng T·ªìn ƒë·∫ßu ca chi·ªÅu l√† 43
          handoverData = {
            handoverReportId: kitchenReport.id,
            materialId: materialId,
            morningBeginning: 30,
            morningReceived: 15,
            morningIssued: 5,
            morningEnding: 40, // B√°o c√°o sai
            afternoonBeginning: 43, // Kh√¥ng kh·ªõp v·ªõi morningEnding = 40
            afternoonReceived: 10,
            afternoonIssued: 8,
            afternoonEnding: 45,
            eveningBeginning: 0,
            eveningReceived: 0,
            eveningIssued: 0,
            eveningEnding: 0,
          };
        } else if (material.name === 'G√†') {
          // Case 3: Ca s√°ng b√°o c√°o sai - T·ªìn cu·ªëi 40, nh∆∞ng T·ªìn ƒë·∫ßu ca chi·ªÅu l√† 35
          handoverData = {
            handoverReportId: kitchenReport.id,
            materialId: materialId,
            morningBeginning: 25,
            morningReceived: 20,
            morningIssued: 5,
            morningEnding: 40, // B√°o c√°o sai
            afternoonBeginning: 35, // √çt h∆°n morningEnding = 40
            afternoonReceived: 12,
            afternoonIssued: 7,
            afternoonEnding: 40,
            eveningBeginning: 0,
            eveningReceived: 0,
            eveningIssued: 0,
            eveningEnding: 0,
          };
        } else if (material.name === 'Ch·∫£ c√°') {
          // Normal case - all shifts have data
          handoverData = {
            handoverReportId: kitchenReport.id,
            materialId: materialId,
            morningBeginning: 20,
            morningReceived: 10,
            morningIssued: 8,
            morningEnding: 22,
            afternoonBeginning: 22,
            afternoonReceived: 15,
            afternoonIssued: 12,
            afternoonEnding: 25,
            eveningBeginning: 25,
            eveningReceived: 5,
            eveningIssued: 10,
            eveningEnding: 20,
          };
        } else if (material.name === 'Khoai t√¢y') {
          // Normal case - food item
          handoverData = {
            handoverReportId: kitchenReport.id,
            materialId: materialId,
            morningBeginning: 5,
            morningReceived: 8,
            morningIssued: 6,
            morningEnding: 7,
            afternoonBeginning: 7,
            afternoonReceived: 5,
            afternoonIssued: 4,
            afternoonEnding: 8,
            eveningBeginning: 8,
            eveningReceived: 3,
            eveningIssued: 5,
            eveningEnding: 6,
          };
        } else {
          // Default case for other materials
          handoverData = {
            handoverReportId: kitchenReport.id,
            materialId: materialId,
            morningBeginning: 10,
            morningReceived: 5,
            morningIssued: 3,
            morningEnding: 12,
            afternoonBeginning: 12,
            afternoonReceived: 2,
            afternoonIssued: 4,
            afternoonEnding: 10,
            eveningBeginning: 10,
            eveningReceived: 1,
            eveningIssued: 2,
            eveningEnding: 9,
          };
        }
        
        kitchenHandoverMaterials.push(handoverData);
      }

      // Create handover materials for drink report - map all drink materials
      const drinkHandoverMaterials = [];
      
      for (const material of drinkMaterials) {
        const materialId = materialMap.get(material.name);
        
        let handoverData;
        
        if (material.name === '7Up') {
          // Case 1: Ca s√°ng kh√¥ng update
          handoverData = {
            handoverReportId: drinkReport.id,
            materialId: materialId,
            morningBeginning: 0,
            morningReceived: 0,
            morningIssued: 0,
            morningEnding: 0,
            afternoonBeginning: 100,
            afternoonReceived: 50,
            afternoonIssued: 30,
            afternoonEnding: 120,
            eveningBeginning: 0,
            eveningReceived: 0,
            eveningIssued: 0,
            eveningEnding: 0,
          };
        } else if (material.name === 'Pepsi') {
          // Case 2: B√°o c√°o sai
          handoverData = {
            handoverReportId: drinkReport.id,
            materialId: materialId,
            morningBeginning: 80,
            morningReceived: 20,
            morningIssued: 15,
            morningEnding: 85, // B√°o c√°o sai
            afternoonBeginning: 90, // Kh√¥ng kh·ªõp v·ªõi morningEnding
            afternoonReceived: 30,
            afternoonIssued: 25,
            afternoonEnding: 95,
            eveningBeginning: 0,
            eveningReceived: 0,
            eveningIssued: 0,
            eveningEnding: 0,
          };
        } else if (material.name === 'Su·ªëi') {
          // Normal case
          handoverData = {
            handoverReportId: drinkReport.id,
            materialId: materialId,
            morningBeginning: 50,
            morningReceived: 20,
            morningIssued: 15,
            morningEnding: 55,
            afternoonBeginning: 55,
            afternoonReceived: 25,
            afternoonIssued: 20,
            afternoonEnding: 60,
            eveningBeginning: 60,
            eveningReceived: 10,
            eveningIssued: 15,
            eveningEnding: 55,
          };
        } else {
          // Default case for other drink materials
          handoverData = {
            handoverReportId: drinkReport.id,
            materialId: materialId,
            morningBeginning: 30,
            morningReceived: 15,
            morningIssued: 10,
            morningEnding: 35,
            afternoonBeginning: 35,
            afternoonReceived: 20,
            afternoonIssued: 15,
            afternoonEnding: 40,
            eveningBeginning: 40,
            eveningReceived: 10,
            eveningIssued: 12,
            eveningEnding: 38,
          };
        }
        
        drinkHandoverMaterials.push(handoverData);
      }

      // Insert all handover materials
      const allHandoverMaterials = [...kitchenHandoverMaterials, ...drinkHandoverMaterials];
      
      for (const material of allHandoverMaterials) {
        await prisma.handoverMaterial.create({
          data: material
        });
      }

      console.log(`‚úÖ Created ${allHandoverMaterials.length} handover materials for ${label}`);
    }

    console.log('üéâ Handover materials seed completed successfully!');
    
    // Print summary
    const materialCount = await prisma.material.count();
    const reportCount = await prisma.handoverReport.count();
    const handoverMaterialCount = await prisma.handoverMaterial.count();
    
    console.log('\nüìä Summary:');
    console.log(`- Materials: ${materialCount}`);
    console.log(`- Handover Reports: ${reportCount}`);
    console.log(`- Handover Materials: ${handoverMaterialCount}`);

  } catch (error) {
    console.error('‚ùå Error seeding handover materials:', error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

// Run the seed function
seedHandoverMaterials()
  .then(() => {
    console.log('‚úÖ Seed completed');
    process.exit(0);
  })
  .catch((error) => {
    console.error('‚ùå Seed failed:', error);
    process.exit(1);
  }); 